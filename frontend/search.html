<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Найти занятия — РазвиТайм</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<header class="app-header">
  <div class="container app-header-inner">
    <div class="logo-block">
      <img src="assets/logo.png" alt="РазвиТайм" class="logo-image">
      <div class="logo-texts">
        <div class="logo-text-main">РазвиТайм</div>
        <div class="logo-text-sub">умное расписание для семьи</div>
      </div>
    </div>
    <nav class="nav-links">
      <a href="index.html">Главная</a>
      <a href="auth.html">Войти</a>
    </nav>
  </div>
</header>

<main class="page-search">
  <div class="container search-layout">

    <!-- Фильтры -->
    <aside class="filters-card">
      <h3>Фильтры</h3>

      <div class="filter-group">
        <label class="filter-label">Возраст ребёнка</label>
        <select class="filter-select" id="filter-age">
          <option value="">Любой возраст</option>
          <option value="3">3–5 лет</option>
          <option value="6">6–8 лет</option>
          <option value="9">9–12 лет</option>
          <option value="13">13–17 лет</option>
        </select>
      </div>

      <div class="filter-group">
        <label class="filter-label">Направление</label>
        <select class="filter-select" id="filter-category">
          <option value="">Любое</option>
          <option>Спорт</option>
          <option>Творчество</option>
          <option>Наука и технологии</option>
          <option>Языки</option>
        </select>
      </div>

      <div class="filter-group">
        <label class="filter-label">Город</label>
        <input class="filter-input" type="text" id="filter-city" placeholder="Например, Симферополь">
      </div>

      <div class="filter-group">
        <label class="filter-label">Поиск</label>
        <input class="filter-input" type="text" id="filter-text" placeholder="Название занятия или центра">
      </div>

      <div class="filters-actions">
        <button class="btn btn-primary btn-sm" id="search-activities-btn">Применить фильтры</button>
        <button class="btn btn-secondary btn-sm" onclick="resetFilters()">Сбросить</button>
      </div>
    </aside>

    <!-- Результаты -->
    <section>
      <div class="search-header-line">
        <h2>Найденные занятия</h2>
        <div class="search-controls">
          <input type="text" id="simple-search-input" placeholder="Быстрый поиск..." class="search-input">
          <button class="btn btn-primary btn-sm" id="simple-search-btn">Найти</button>
        </div>
      </div>

      <div id="activities-results" class="activities-list">
        <!-- Результаты загрузятся через JavaScript -->
      </div>
    </section>
  </div>
</main>

<footer class="app-footer">
  <div class="container app-footer-inner">
    <div>© 2025 РазвиТайм.</div>
    <div class="footer-links">
      <a href="#">О платформе</a>
      <a href="#">Контакты</a>
    </div>
  </div>
</footer>

<script>
  const API_BASE = "http://localhost:5000";

  function resetFilters() {
    document.getElementById('filter-age').value = '';
    document.getElementById('filter-category').value = '';
    document.getElementById('filter-city').value = '';
    document.getElementById('filter-text').value = '';
    loadActivities();
  }

async function loadActivities() {
  const resultsContainer = document.getElementById('activities-results');
  resultsContainer.innerHTML = '<p>Загрузка...</p>';

  try {
    const response = await fetch(`${API_BASE}/api/public/activities`);
    const activities = await response.json();

    if (!activities || !activities.length) {
      resultsContainer.innerHTML = '<p>Занятий не найдено</p>';
      return;
    }

    resultsContainer.innerHTML = activities.map(activity => `
      <article class="activity-card">
        <div class="activity-main">
          <h3>${activity.title || 'Без названия'}</h3>
          <div class="activity-meta">
            <a href="center_info.html?id=${activity.center_id}" class="link-as-button">
              ${activity.center_name || 'Центр'}
            </a> · ${activity.city || 'Город не указан'}
          </div>
          <div class="activity-tags">
            <span class="tag-chip">${activity.category || 'Без категории'}</span>
            ${activity.min_age || activity.max_age ? 
              `<span class="tag-chip">${activity.min_age || '?'}–${activity.max_age || '?'} лет</span>` : 
              ''}
          </div>
          <p class="activity-desc">
            ${activity.description ? 
              (activity.description.length > 140 ? 
                activity.description.substring(0, 140) + '...' : 
                activity.description) : 
              'Описание отсутствует'}
          </p>
        </div>
        <div class="activity-side">
          <div class="activity-price">Цена по запросу</div>
          <div>
            <button class="btn btn-primary btn-sm" onclick="viewActivity(${activity.id})">
              Подробнее
            </button>
            <button class="btn btn-secondary btn-sm" onclick="viewCenter(${activity.center_id})" style="margin-top: 8px;">
              О центре
            </button>
          </div>
        </div>
      </article>
    `).join('');
  } catch (error) {
    console.error('Error loading activities:', error);
    resultsContainer.innerHTML = '<p>Ошибка загрузки занятий</p>';
  }
}

// Добавьте эти функции
function viewActivity(activityId) {
  window.location.href = `activity.html?id=${activityId}`;
}

function viewCenter(centerId) {
  window.location.href = `center_info.html?id=${centerId}`;
}
    

  // Инициализация поиска
  document.addEventListener('DOMContentLoaded', function() {
    loadActivities();
    
    document.getElementById('search-activities-btn').addEventListener('click', loadActivities);
    document.getElementById('simple-search-btn').addEventListener('click', loadActivities);
    
    document.getElementById('simple-search-input').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        loadActivities();
      }
    });
  });
</script>
</body>
</html>